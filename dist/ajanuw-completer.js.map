{"version":3,"file":"ajanuw-completer.js","sources":["../src/completer.ts"],"sourcesContent":["abstract class _Completer<T> {\r\n  abstract promise: Promise<T>;\r\n  /**\r\n   * * [promise] 是否完成\r\n   * * 反映是否已调用[complete]或[completeError]\r\n   * * 当此值为true时，[complete]和[completeError]不得再次调用。\r\n   */\r\n  isCompleted: boolean = false;\r\n\r\n  protected abstract _res: (value?: T) => void;\r\n  protected abstract _rej: (error?: any) => void;\r\n\r\n  abstract complete(value: T): void;\r\n  abstract completeError(error: any): void;\r\n}\r\n\r\n/**\r\n * Example\r\n * ```ts\r\n * let _data: Completer<number> = new Completer<number>();\r\n * _data.promise\r\n *   .then(v => {\r\n *     console.log(v); // 233\r\n *   })\r\n *   .catch(er => {\r\n *     console.log(er);\r\n *   });\r\n *\r\n * setTimeout(() => {\r\n *   _data.complete(233);\r\n *   console.log(_data.isCompleted); // true\r\n * }, 2000);\r\n * ```\r\n */\r\nexport class Completer<T> extends _Completer<T> {\r\n  protected _res!: (value?: T | undefined) => void;\r\n  protected _rej!: (error?: any) => void;\r\n  public promise: Promise<T>;\r\n\r\n  /**\r\n   * TODO: 未实现\r\n   */\r\n  // static sync() {}\r\n\r\n  constructor() {\r\n    super();\r\n    this.promise = new Promise<T>((res, rej) => {\r\n      this._res = res;\r\n      this._rej = rej;\r\n    });\r\n  }\r\n\r\n  complete(value: T): void {\r\n    if (this.isCompleted) throw Error(\"Promise already completed\");\r\n    this._res(value);\r\n    this.isCompleted = true;\r\n  }\r\n\r\n  completeError(error: any) {\r\n    if (this.isCompleted) throw Error(\"Promise already completed\");\r\n    this._rej(error);\r\n    this.isCompleted = true;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;EAAA,MAAe,UAAU;MAAzB;;;;;;UAOE,gBAAW,GAAY,KAAK,CAAC;OAO9B;GAAA;EAED;;;;;;;;;;;;;;;;;;AAkBA,QAAa,SAAa,SAAQ,UAAa;;;;;MAU7C;UACE,KAAK,EAAE,CAAC;UACR,IAAI,CAAC,OAAO,GAAG,IAAI,OAAO,CAAI,CAAC,GAAG,EAAE,GAAG;cACrC,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;cAChB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;WACjB,CAAC,CAAC;OACJ;MAED,QAAQ,CAAC,KAAQ;UACf,IAAI,IAAI,CAAC,WAAW;cAAE,MAAM,KAAK,CAAC,2BAA2B,CAAC,CAAC;UAC/D,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;UACjB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;OACzB;MAED,aAAa,CAAC,KAAU;UACtB,IAAI,IAAI,CAAC,WAAW;cAAE,MAAM,KAAK,CAAC,2BAA2B,CAAC,CAAC;UAC/D,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;UACjB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;OACzB;GACF;;;;;;;;;;;;"}